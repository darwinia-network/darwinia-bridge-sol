const { ethers } = require("ethers");
const { toHexString } = require('@chainsafe/ssz')
const rlp = require("rlp")
const InboundLane = require("../../artifacts/src/message/SerialInboundLane.sol/SerialInboundLane.json");

(async () => {
  const iface = new ethers.utils.Interface(InboundLane.abi)
  const outboundLaneData = {
    latest_received_nonce: 116,
    messages: [
      {
        encoded_key: '0x0000000000000000000000010000000000000000000000010000000000000075',
        payload: {
          source: '0x7181932da75bee6d3604f4ae56077b52fb0c5a3b',
          target: '0x0000000000000000000000000000000000000000',
          encoded: '0x'
        }
      }
    ]
  }
  const accountProof = ["0xf90211a0b6ed6b143f24b17953349f73dc8deebb5883eb1fbbb29c4e44d1bedf45fcb95ea062b59a1d26d676f2f202116393b79aea5113fb5d0b719768d61d7c861012cc3da048b5b1d8bddfaee371437080413b045668cf25e919e404bd096949df34db1827a00399c14330cc0e4bae6ed0e77e234b0d5d3607b2913c77a325152c6b4cba96c9a045af657e2db51d54f42ed2d523c9ebef8adcfa039eec9425eeb8631cc541a287a0d52a90f9cdcdd29743434e69c1cef7cdca132157f4f48a11ce08d7425ec13cd5a0711461f1baba4f976416bc4c953959837dac3661ce9f5b67420351a9dab19229a0540f389177a408105085da5f4638f035eaebb7374e81a3fa6c647ec85b7053a0a0bf40b7ab9a6ec07d7dccd49fae926a2822bbb6c156a2b622968da4e5508db35da0781ed66f9231f6ec1e64e4d359422ec77c027c421af1eb1b3eac45e2815e569aa03a997812f773449f19d1a6bd166376c61ed2d2a1cca142cf94d7d37379d7a6e9a025d558f0c27ad86aa648bff30a02c9f05372d876557af59071203c66da7d30bea0a7cc1965aa84bc32a625768c6fa3168182e2168a96d5dbe3d5bbf6b708bbc0d7a0bacb8bedb25ff75f6358faede7b7f2dac66dc8123cc7c55ffed43db2636234aaa046a2069af67ad762fc0b1e60dfc77f98dd0e403be9fbf05a71df98b18f425dc9a018de606af5fd1a35649fc0e818fc956c4df43a3931e19add36d8625d97cae37180","0xf90211a0fd002a39b0e382af4ee8ca4d14af700ec43e337c4ccfbc0a5e042bf88916ce4ba088691800e0a6732858a0f564ab2e064a73b575308b881121b3588442a6bd5da0a0b0fbc3a20a2f4aae4f9626a5fabcb1a96f23651b21af1b61cee49d222fcfdf1aa0bf3ea84737586c1593d2f5d564225c4ebf7a222d2a694daa7f48a20a87b23264a02e71768a9c15d9c9c0725bf63123b72f6b8cf9d66ea7b3242d09f4bd2bc41ef6a03a46ef5be1ee1f38088984695eeed9e150fdd71023f9c27f526f9d03c0e78583a08601291f4272ab1232c64fa7daa54a9e0f378217359dc117f38524d18194282ba02462cd65a6dad12b90286e8017d6bbaff0df0965e2cef765261b937b6534f9c9a0bce91d5d2b70be67ab03984ac378f86f22b704412f6e6533cab75434ad510426a05ea06050ba14e111ab4ad13f3f31f8594f799ddc29722f1bd9478ff1be046109a0d019976f190f83fefd8a742610dd1e685f27f76cb828de7de8ea94e06a7cd0c5a082c0fd480ebb31e9eaa813530917e447cc6627cbd5f71c98380444689fb830dea0385381cf62069d2be9adb96c124f1583a719de286077a577864e0e5285e0e84ea056cd3e0e11495b5e813e40405edba8912bebe3a36ae7402f7179546117435836a0ceb5de1149b43f5afc32b1ba3684fa291cfbd09b1e9b095fd738e9fe5ff72ef5a0c04e25d56c2b5aff24f9bbbf39299bf4642d1e25f9a5cc1b85119c45e24faa8680","0xf90211a00bb78deb8999ad67f3be444770a6710518d4d44ccc95e9990842884db21fbbaba0a884a0557f4a334ccff80623b2f9b15ee0befed49a761b8da3b2965a7eaa4fc2a0ffa4993d4dea1d200656c528c085a07360256f76ea75aa3c9206ff11a539c0b1a0ebc55876cbf834f5d448c67a78994e8a13895901c99e34be2fe9c2d3ddcad94fa02d88dda445fd9a5025afff9f6c945682201f77f62095458b53a0cb8a52ebe1c3a0390cbb39f6c859fd63b36bd5ade32b49c0b973b17541ee4b2c8f7535213e2f84a0b41dcabcc534c426f69d49ab8d2e8bde8547e05184378ad143b12cb281d7e8eea0caa75ae0b917ec073658cf77d877292fff9d34553614232bc438074ac7973168a0dba93baa0079e493867d606e6a30181ec848cae5d10116d3f9ae52fbce14c12ca0bb35108f6e27b93c6534230dbb3ac26931d69d0f7dfa211b810d15e689f65c17a0513e72ad5e0ba18b80362b76c739ef4a3e9a74c865f3c25ecf7046cf633f9b01a09f19a30e64283b81dff56750b07e90cc2bde8076e86bcca5f47b56f51f0fd202a005749ce7c28adbce0375f0c5057e1107cd7a30e12f220ad2ecda269c98ba5c1ea0f274f3184af7a8baa9edd9d756fd7c019f5e78d1235ad9bbd6e3e93e35559feaa0c1c06b4f4d07737a05857c8fb891faee97ed7f3b53006d5013c3ed76cc2a555fa03a518d4f8312efa6b4009e2e13d19c99fd307e1c86d3949a3fe910d6f4e1286180","0xf90211a040718638e89e72bec3aaa1f3dd9e9d87817846c6ea455cbceb5eba0a4ba0d20ca0039e1cce49c9b4262a572bf82f5670016ec97605294f8c2f9fc6c45e4ef88a89a0e3ed3754a34e968a3ebc3a72256d8ab3ab31ec3a5f0413f0a04e64e978e4819ea054005853d486af2ff464740ff92b103388b2ad10ccb71c79e0b3f3ad4cb324baa04ed55bfda21636670e028c704a4de05285572d01ee95297bf7080b408df4d8dca02797182d3c985f90c8dbc8dcc43760801896594a3f4b3ff792c71440938f7039a0cc511d24f1a1406a11ac549679d6d3a66707ae483ad965f3bd41e64e308fab7aa0789970f1f593e9d1214d16be896ba1b1b0dc50a05e8a79d94efe4c1af57ff98aa011e4d36131a33b89220a6a5f2b6f14ff0f8076bf8f579b4329c7dacbbcad09dea0fea5c7d8bdedf5bc1fa546b1abe46b918f5b0ce8d199735d8647debe97f1b8dda09537c7b0f31ac76ba67dc6ea54c88945b36e8fb90e5fe7ce43a02ca779631c42a0dd56f83b32de10ec9ece46aabe5b7bbd12b3aac7ff8a740c1c566081beb0f227a09b48ab1876f596638ea333e9a14c52cf7ce7efb2bb4e684d46b81dd53399da04a0a5138f496d058c6c1fb1494aced9d602692a1caeaa85cc84e32e808c6d8aa63aa06d9fd0b9a9255b8cc46e114a32c96033f38b202ad731159532662888f4ccdffba097d502ea18d9fe47a8de13675ee6b1f85cdd5491e33acc4e0cd2b06f3a6f775480","0xf90211a086dc7e41e19c8a8e6a2144b21a1d11e1c1314dd9d2fd050c17169e252a8e03f5a0114c2519c859fdb2bf1863a7c5458c41aad39711389791cfad04a9319be2a675a04fe21df9ca063a9969704ec88e4cb456e6826ecf9b7fa8d7f55f4cf5e7a1aa39a06000dfc2c81969b3e2a7497d2929c52bf500b76ece9f4657ec82e09a2a197099a019e25985fb373e352ac8e7a4fefc6e4d81fc2936e63f607735fe0382e44e0bcba071c348ff4347d4f63f9a2719629cbd9cf2d5bf3ac563dceb889bf9932e1104d0a009790a175864656ac85cf2676aa3890c69241e9594679f2a19f8b263f25fd555a00e5f7da1337877b2418ea778ddb8498506f0d521000f6be71982c56b02fb4091a030a0790d6be962ad72be1a20c853b71672387e08596705b7dc17179a987b26d0a0726725cc29a9f0320d100b62bbca7e1b3b77b4b560d240f3f27c2c24df588a27a06e83f8d3c8b76a702dd29b613ff868d7f538dcc0e60db9690b1f491173211d6ba0a14179549847f1a01530a2b6b6d2fb02c328a411f9127482e361f73f4c2899c3a0c1f71bc1ffb9f18c91d45cbc48e36a4bcc2679eab3c1e9a6a8c3e19f2c825bb9a02d0f679ffcb3a45f34fb29a54354e489e7cbf1ee16d946d1046662af563d4160a069e689a80e64595e5955276b712a3cf19fdaf71fa1017f389f73f3d1aaa74219a08521ff3adcc1c930c7deea77a79f59fb082f708e094029efb7017582fd05964880","0xf901318080a042dad303fa5f793c890ae25431a63d43f72eb064e168bcd244ff2a69e930637c80a0340660a46bc6c886e896a599133651c278957d118e4a15f05f70942b44478f4c80a0981a31ba9abe7d5941909465e01bbed16f0be756125f3fe6552666eea9ca35b5a0d58e96703581bb92045c00d220f47f8eb89ff322959569d4053d990c9587109180a03e8413965d4c3c03731b6b3250d3b137d98031b936a5a6cd4d8b1911f6103088a06d8f669acbd6c12769c92709ef0b607f1b4cc49a5867a6b30b416d99746be8cca0c5a02b7c5a726b367701980271dd6ec13ebbb70a09fbc9d43ef17b9e63fee546a0b31e6e7235a5d662c40dcc374e944c5cd881f52d9a9089864472bb2ac81628faa028b7e3fec9eb9ed857c3b35aa9aa03404ed06c354094e569727db97cfa734b84808080","0xf891808080a0b91830f6e31ef1461b6bacad8a8b7981d3255bb1f1f4b6f14d9dfa8d573512d3a05aaec6d275522ad0efea4326dbd9a8a9f2113deda253b26b638f0f24e4f28c1980808080808080a02131b469b1c5ab01ed7ceffe4ff50be9426e59c8b858434829de3fc304c66bc3a09bfe8f7bb99fe32efa17f9fe3184a670b48cb2d3d979416a41eb61f946a680a4808080","0xf8669d36f93a6ed7b5673ae0ac2dcb36dff05fc6e7b369552c793332b9b553a7b846f8440180a08661799e1d972a1945c9a2e71bce9faa300d8594904099914c857c35fccf95bda071c2e48e17a89a2b0ae714cba688ac577b4ed0529d14477287443eb078603aea"]

  const laneIdStorageProof = ["0xf8d1a07caf8e8883b52881c2a54126114e4a937271774e0b4c1ff7fab72ceb747d502080a0b01d8331a0e017cfac79e689b32b69f9fedaa97b232f125c740e7cad4e75869480a0fc72f4ec722c90ea546be2d2405212366009aefd552716715c90d6b6f8f8fbef808080808080a0cb4b58e4acce62b6ee4bdcb76f8df4535b9757e0e4b62d039b7cb20b2029d740a02ab1ed7ae148873d2c7febebcc48140eeddaba742c9fe622f16a79e27bea8a628080a0e4c8b0c1efa631ab2d6820caa018edd93342b736128bd35a2abaf040957bd00780","0xf851808080808080808080a0e9009984a8f5f212cedbe84169dd8fbb58ee7a59a1a2f5197d4da9ccceee81738080a0a8e2c049f8691f4606b86901888487659cd17ab1d836bf02a25ace249bf66bcf80808080","0xf0a0200decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e5638e8d01000000000000000000000001"]
  const landNonceStorageProof = ["0xf8d1a07caf8e8883b52881c2a54126114e4a937271774e0b4c1ff7fab72ceb747d502080a0b01d8331a0e017cfac79e689b32b69f9fedaa97b232f125c740e7cad4e75869480a0fc72f4ec722c90ea546be2d2405212366009aefd552716715c90d6b6f8f8fbef808080808080a0cb4b58e4acce62b6ee4bdcb76f8df4535b9757e0e4b62d039b7cb20b2029d740a02ab1ed7ae148873d2c7febebcc48140eeddaba742c9fe622f16a79e27bea8a628080a0e4c8b0c1efa631ab2d6820caa018edd93342b736128bd35a2abaf040957bd00780","0xf4a0310e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf692917000000000000000750000000000000074"]
  const laneMessagesStorageProof = ["0xf8d1a07caf8e8883b52881c2a54126114e4a937271774e0b4c1ff7fab72ceb747d502080a0b01d8331a0e017cfac79e689b32b69f9fedaa97b232f125c740e7cad4e75869480a0fc72f4ec722c90ea546be2d2405212366009aefd552716715c90d6b6f8f8fbef808080808080a0cb4b58e4acce62b6ee4bdcb76f8df4535b9757e0e4b62d039b7cb20b2029d740a02ab1ed7ae148873d2c7febebcc48140eeddaba742c9fe622f16a79e27bea8a628080a0e4c8b0c1efa631ab2d6820caa018edd93342b736128bd35a2abaf040957bd00780","0xf843a03bb9f620f38a5b436ae50b5139b5bcf568fc5f9daba24e446cb4fbfbad36868ca1a0f68a7103167104b132a65ee29f46cb238d61f3ca1813cc87155928bab0af5ac1"]
  const proof = {
    "accountProof": toHexString(rlp.encode(accountProof)),
    "laneIDProof": toHexString(rlp.encode(laneIdStorageProof)),
    "laneNonceProof": toHexString(rlp.encode(landNonceStorageProof)),
    "laneMessagesProof": [toHexString(rlp.encode(laneMessagesStorageProof))],
  }
  const messagesProof = ethers.utils.defaultAbiCoder.encode([
    "tuple(bytes accountProof, bytes laneIDProof, bytes laneNonceProof, bytes[] laneMessagesProof)"
    ], [ proof ])
  console.log(await iface.encodeFunctionData("receive_messages_proof", [ outboundLaneData, messagesProof, 1]))
})();
